<main class="container">
    <h1>Single Course</h1>
    <div style="position: absolute !important; top: 0; right: 0;">
      <div role="alert" aria-live="assertive" aria-atomic="true" id="message" class="toast" data-delay="2000">
        <div class="toast-header" id="toast-header"></div>
        <div class="toast-body" id="toast-body"></div>
      </div>
    </div>

    <section class="card shadow p-2 my-2 col-12 courses-card">
        <p id="id" data-doc="{{ user?._id }}"></p>
        <h3>{{course.name}}</h3>
        <p>{{course.description}}</p>
        <p>Subject Area: {{course.subjectArea}}</p>
        <p>Credits: {{course.credits}}</p>
        <p>Instructor: {{course.instructor.firstName}} {{course.instructor.lastName}}</p>
      {{#if isStudent}}
        <button class="btn btn-success add-to-cart-btn" data-doc="{{course._id}}">Add To Cart</button>
      {{/if}}
      <a href="/courses">All Courses</a>
    </section>
</main>

<script>
  const popToast = (success) => {
    console.log('Success: ', success)
      const title = 'Success'
      const message = 'Course added to cart'
      const toastHeader = document.getElementById('toast-header')
      const toastBody = document.getElementById('toast-body')

      toastHeader.innerText = title
      toastBody.innerText = message

      $('#message').toast('show')
  }
  document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
    btn.addEventListener('click', async (e) => {
      e.preventDefault()
      const options = {
        method: 'POST',
        body: JSON.stringify({
          itemToUpdate: btn.dataset.doc,
          cartAction: 'add'
        }),
        headers: { 'Content-Type': 'application/json' }
      }
      console.log('options', options)
      const cartUpdateReq = await fetch(`/cart`, options)
      console.log('Cart update req: ', cartUpdateReq)
      popToast(cartUpdateReq.status === 200)
    })
  })
</script>